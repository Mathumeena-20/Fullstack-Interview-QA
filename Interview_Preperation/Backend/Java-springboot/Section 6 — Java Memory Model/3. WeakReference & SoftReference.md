# **1. What are Strong, Soft, Weak, and Phantom references?**

Java provides 4 types of references, each with different GC behavior.

## ✔ **1. Strong Reference (Default)**

```java
String s = new String("Hello");
```

* Most common
* GC **never** removes a strongly reachable object
* Object is freed **only when no strong reference** exists

---

## ✔ **2. Soft Reference**

```java
SoftReference<Data> ref = new SoftReference<>(new Data());
```

* Cleared **only when JVM is low on memory**
* Ideal for **memory-sensitive caches**

---

## ✔ **3. Weak Reference**

```java
WeakReference<Data> ref = new WeakReference<>(new Data());
```

* Cleared **immediately in the next GC**, even if memory is sufficient
* Used for **weak caches**, memory maps, listeners, metadata

---

## ✔ **4. Phantom Reference**

```java
PhantomReference<Data> ref = new PhantomReference<>(data, queue);
```

* Object is **already finalized**, but still enqueued
* `get()` always returns **null**
* Used for **post-cleanup**, tracking GC of objects

---

# **2. Difference between SoftReference and WeakReference**

| Feature       | **SoftReference**                 | **WeakReference**              |
| ------------- | --------------------------------- | ------------------------------ |
| Cleared when? | On **low memory**                 | In **next GC cycle**           |
| Use case      | Image cache, memory-heavy objects | Weak maps, listeners, metadata |
| Strength      | Stronger (kept longer)            | Weaker (GC clears quickly)     |
| GC behavior   | Survives 1–2 GCs                  | Almost always cleared          |

---

# **3. When should you use WeakReference?**

Use WeakReference when you want:

### ✔ Objects to be removed **as soon as they are not strongly referenced**

Examples:

* **WeakHashMap keys**
* Cache entries that should disappear quickly
* Listeners in event systems
* Avoiding memory leaks in observer patterns

### Example:

```java
Map<Key, Value> map = new WeakHashMap<>();
// Keys removed automatically when no strong reference exists
```

---

# **4. When should you use SoftReference?**

Use SoftReference when:

✔ You want objects cached until **memory runs low**
✔ Useful for expensive objects (images, HTML templates, large data)
✔ Ideal for **in-memory cache** with adaptive eviction

Example:

```java
SoftReference<byte[]> imageCache = new SoftReference<>(loadImage());
```

---

# **5. How are these references used in caching?**

### ✔ SoftReference → memory-sensitive caching

Keep object unless memory needed.

### ✔ WeakReference → weak caching

Remove object eagerly when unused.

### Example: Soft cache

```java
SoftReference<Data> cache = new SoftReference<>(expensiveData);
Data d = cache.get();
if (d == null) d = loadAgain();
```

### Example: Weak cache (WeakHashMap)

```java
Map<Object, Object> cache = new WeakHashMap<>();
```

WeakHashMap removes entries when keys are no longer strongly referenced.

---

# **6. Does WeakReference prevent GC?**

❌ **NO.**

WeakReference **never** prevents garbage collection.

If only a WeakReference points to an object:

* Object becomes **immediately eligible** for GC
* Removed in **next GC cycle**

---

# **7. What happens to SoftReference during low memory?**

When JVM is running low on memory:

✔ GC will **clear SoftReference** before throwing `OutOfMemoryError`.

So SoftReferences:

* Survive multiple GC cycles
* But get removed **before JVM crashes**

---

# **8. What is ReferenceQueue?**

A `ReferenceQueue` is used to get a **notification when a referenced object is cleared by GC**.

Example:

```java
ReferenceQueue<Data> queue = new ReferenceQueue<>();
WeakReference<Data> ref = new WeakReference<>(new Data(), queue);

// GC runs → object cleared → ref added to queue
Reference<?> removed = queue.poll();
```

Used for:

* Cleaning custom caches
* Resource cleanup
* Tracking garbage collection

---

# **9. What is PhantomReference used for?**

PhantomReference is used for:

### ✔ Post-GC cleanup

### ✔ Cleaning native resources (file handles, buffers)

### ✔ Tracking object lifecycle (after finalization)

### ✔ Creating custom memory management tools

**Important:**
`get()` returns **null**, meaning you cannot use phantom references to access the object.

Example:

```java
PhantomReference<Data> pr = new PhantomReference<>(data, queue);
```

PhantomReference is added to the queue **after finalization** → allowing cleanup.

---

# **10. Real-world example of WeakReference**

✔ **Avoid memory leaks in event listeners**

Example: GUI framework

* Listener registered for events
* Listener not removed → memory leak

Solution: use WeakReference so listener auto-removed.

### Example:

```java
class Listener {
    public void onEvent() {}
}

Listener listener = new Listener();
WeakReference<Listener> weakListener = new WeakReference<>(listener);

// After some time, if no strong reference exists → GC clears listener
```

✔ Another classic example: `WeakHashMap`
Used for:

* Caching metadata
* Storing expensively computed values
* Removing entries automatically

---

# ⭐ Final Interview Summary

| Question                       | Short Answer                                             |
| ------------------------------ | -------------------------------------------------------- |
| Strong / Soft / Weak / Phantom | Different levels of reachability                         |
| Soft vs Weak                   | Soft survives until low memory; Weak cleared immediately |
| Use WeakReference              | WeakHashMap, listeners, metadata                         |
| Use SoftReference              | Caches, large objects                                    |
| WeakReference block GC?        | ❌ No                                                     |
| SoftReference in low mem       | Cleared before OOM                                       |
| ReferenceQueue                 | Callback on GC cleanup                                   |
| PhantomReference               | Post-GC cleanup, native resource release                 |
| Real example of WeakReference  | WeakHashMap, event listeners                             |

---

