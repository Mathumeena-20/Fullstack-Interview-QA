# **1. What is ExecutorService?**

`ExecutorService` is a **high-level thread management framework** in Java that:

✔ Manages a pool of threads
✔ Executes tasks asynchronously
✔ Eliminates manual thread creation
✔ Provides lifecycle control (shutdown)
✔ Supports `Runnable` and `Callable`

### Example:

```java
ExecutorService service = Executors.newFixedThreadPool(5);
service.submit(() -> System.out.println("Task running"));
service.shutdown();
```

---

# **2. Difference between execute() and submit()**

| Feature            | execute()              | submit()                   |
| ------------------ | ---------------------- | -------------------------- |
| Input              | Runnable only          | Runnable or Callable       |
| Return type        | void                   | Future object              |
| Exception handling | Exception kills thread | Exception stored in Future |
| Return value       | No return              | Callable can return value  |

### Example:

```java
service.execute(() -> task());            // can't return value
Future<Integer> f = service.submit(() -> 10);   // returns 10
```

---

# **3. Types of Thread Pools**

## **1) FixedThreadPool**

* Fixed number of threads
* Tasks beyond limit are queued
* Good for CPU-bound tasks

```java
ExecutorService pool = Executors.newFixedThreadPool(10);
```

---

## **2) CachedThreadPool**

* Grows thread count dynamically
* Removes idle threads after 60 sec
* For many short-lived tasks
* Good for IO-bound tasks

```java
ExecutorService pool = Executors.newCachedThreadPool();
```

---

## **3) ScheduledThreadPool**

* Supports `schedule()` and `scheduleAtFixedRate()`
* Used for cron-like scheduled tasks

```java
ScheduledExecutorService scheduler = Executors.newScheduledThreadPool(5);

scheduler.schedule(() -> System.out.println("Run after 3s"), 3, TimeUnit.SECONDS);
```

---

## **4) WorkStealingPool (Java 8)**

* Uses **ForkJoinPool** internally
* Threads "steal" tasks from each other
* Good for **parallel processing**

```java
ExecutorService pool = Executors.newWorkStealingPool();
```

---

# **4. How Does Thread Pool Improve Performance?**

✔ Threads are *reused*, not created again and again
✔ Reduces thread creation overhead
✔ Avoids resource starvation
✔ Provides concurrency without oversubscribing CPU
✔ Improves system throughput
✔ Provides bounded queue to avoid overload

---

# **5. shutdown() vs shutdownNow()**

| Method        | Behavior                                                                          |
| ------------- | --------------------------------------------------------------------------------- |
| shutdown()    | Allows submitted tasks to complete, no new tasks accepted                         |
| shutdownNow() | Attempts to stop running tasks using `interrupt()`, returns list of pending tasks |

### Example:

```java
pool.shutdown();     // graceful
pool.shutdownNow();  // forceful
```

---

# **6. What happens if you don’t shut down ExecutorService?**

❌ JVM does NOT exit — thread pool keeps running
❌ Memory & thread leaks
❌ Program hangs
❌ Continue running hidden background threads

Always call:

```java
pool.shutdown();
```

Or use try-with-resources (Java 19+ has AutoCloseable for ExecutorService).

---

# **7. What is ThreadPoolExecutor?**

`ThreadPoolExecutor` is the **core implementation** behind all thread pools created by `Executors`.

Constructed with:

* corePoolSize
* maximumPoolSize
* keepAliveTime
* TimeUnit
* BlockingQueue
* ThreadFactory
* RejectionHandler

### Example:

```java
ThreadPoolExecutor executor = new ThreadPoolExecutor(
        2, 4, 10, TimeUnit.SECONDS,
        new ArrayBlockingQueue<>(100)
);
```

---

# **8. How to create a custom thread pool?**

### Full example:

```java
ExecutorService pool = new ThreadPoolExecutor(
        2,                 // core threads
        5,                 // max threads
        30, TimeUnit.SECONDS,  // keep alive time
        new LinkedBlockingQueue<>(50), // queue
        Executors.defaultThreadFactory(),
        new ThreadPoolExecutor.AbortPolicy() // rejection handler
);
```

---

# **9. How does task queue work in thread pool?**

Flow of execution:

1. New task submitted
2. If **core threads** are free → execute task
3. If all busy → add to **task queue**
4. If queue full → create **extra threads** up to maxPoolSize
5. If max threads busy and queue full → **task rejected**
6. After idle time, extra threads removed

Queue types:

* `ArrayBlockingQueue`
* `LinkedBlockingQueue`
* `SynchronousQueue`
* `PriorityBlockingQueue`

---

# **10. What is a Rejection Handler?**

When thread pool **cannot accept more tasks**, rejection handler decides behavior.

Java provides 4 built-in policies:

| Handler             | Behavior                             |
| ------------------- | ------------------------------------ |
| AbortPolicy         | Throws `RejectedExecutionException`  |
| DiscardPolicy       | Silently discards task               |
| DiscardOldestPolicy | Drops oldest task in queue           |
| CallerRunsPolicy    | Calls the task in the calling thread |

### Example:

```java
new ThreadPoolExecutor.AbortPolicy()
```

---

# ⭐ CODE EXAMPLES

## Submit a Callable and get result:

```java
ExecutorService pool = Executors.newFixedThreadPool(3);

Future<Integer> result = pool.submit(() -> 10 + 20);

System.out.println(result.get()); // 30
pool.shutdown();
```

---

# ⭐ Final Interview Summary

| Question                | Short Answer                               |
| ----------------------- | ------------------------------------------ |
| ExecutorService         | Framework for thread management            |
| execute() vs submit()   | submit returns Future & handles exceptions |
| Types of thread pools   | Fixed, Cached, Scheduled, WorkStealing     |
| Thread pool performance | Thread reuse + managed concurrency         |
| shutdown vs shutdownNow | Graceful vs forceful stop                  |
| Forget shutdown?        | JVM hangs                                  |
| ThreadPoolExecutor      | Core powerful pool with full control       |
| Custom thread pool      | Use new ThreadPoolExecutor(...)            |
| Task queue working      | Core → Queue → Max threads → Reject        |
| Rejection Handler       | Defines behavior when queue is full        |

---
